<!DOCTYPE html>
<html>
<head>
	<title></title>
	<script type="text/javascript" src="http://code.jquery.com/jquery-1.10.1.js"></script>
	<style type="text/css">
	table {
		height: 10%;
		width : 5%;
		margin: 40px;
		float: left;
	}
	tr:last-child td {
	   border:2pt solid black;
	   text-align: left;
	   height: 20px;
	   max-width: 50px;
	   overflow: hidden;
	}
	</style>
</head>
<body>
<button>Substructions</button>
<button>Additions</button>
<div></div>
</body>
	<script type="text/javascript">
		var answerArray = [];
		var number = (function() {

		    var get40RandomNumber = (function() {
		    	var numberArray = [];
		    	for(var index=0; index<20; index++) {
		    		var tempNumber = (Math.random()*10000);
		    		var numberStringArray = tempNumber.toString();
		    		while(parseInt(numberStringArray[0])==0 || parseInt(numberStringArray[1])==0 || parseInt(numberStringArray[2])==0 || parseInt(numberStringArray[3])==0 || isNaN(parseInt(numberStringArray[0]))|| isNaN(parseInt(numberStringArray[1]))|| isNaN(parseInt(numberStringArray[2]))|| isNaN(parseInt(numberStringArray[3]))) {
		    			tempNumber = (Math.random()*10000);
		    			numberStringArray = tempNumber.toString();
		    		}
		    		numberArray.push(parseInt(numberStringArray[0]+numberStringArray[1]));
		    		numberArray.push(parseInt(numberStringArray[2]+numberStringArray[3]));
		    	}
		    	return numberArray;
		    });

		    var rearrangeNumber = (function(numberArray) {
		    	for(var index=0; index<numberArray.length; index+=2) {
		    		if(numberArray[index+1]>numberArray[index]) {
		    			var temp = numberArray[index+1];
		    			numberArray[index+1] = numberArray[index];
		    			numberArray[index] = temp;
		    		}
		    	}
		    	return numberArray;
		    });

		    this.getNumberSetForAddition = (function() {
		    	var numbersArray = get40RandomNumber();
		    	return numbersArray;
		    });
		    this.getNumberSetForSubstruction = (function() {
		    	var numbersArray = rearrangeNumber(get40RandomNumber());
		    	return numbersArray;
		    });

		});

		var generateSubstructions = (function(substructionSet) {
			var outputHTML= "";
			var numberIndex=0;
			for(var index=0; index<20; index++) {
				outputHTML += "<table data-index='"+index+"'>";
				outputHTML += "<tr><td>&nbsp;&nbsp;&nbsp;&nbsp;" + substructionSet[numberIndex] + "</td></tr>";
				outputHTML += "<tr><td>&nbsp;&nbsp;- " + substructionSet[numberIndex+1] + "</td></tr>";
				outputHTML += "<tr class='last-child'><td contenteditable='true'></td></tr></table>";
				answerArray[index] = substructionSet[numberIndex] - substructionSet[numberIndex+1];
				numberIndex +=2;
			}
			$('div').html(outputHTML);
			bindEvent();
		}); 

		var generateAdditions = (function(substructionSet) {
			var outputHTML= "";
			var numberIndex=0;
			for(var index=0; index<20; index++) {
				outputHTML += "<table data-index='"+index+"'>";
				outputHTML += "<tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;" + substructionSet[numberIndex] + "</td></tr>";
				outputHTML += "<tr><td>&nbsp;&nbsp;+ " + substructionSet[numberIndex+1] + "</td></tr>";
				outputHTML += "<tr class='last-child'><td contenteditable='true'></td></tr></table>";
				answerArray[index] = substructionSet[numberIndex] + substructionSet[numberIndex+1];
				numberIndex +=2;
			}
			$('div').html(outputHTML);
			bindEvent();
		}); 

		var checkResult = (function(value, index, element) {console.log(answerArray[index]);
			if(value==answerArray[index]) {
				$(element).css({
					"background-color" : "#BDF584"					
				});
			} else {
				$(element).css({
					"background-color" : "#F58484"					
				});
			}
		});

		$(document).ready(function() {
			var n = new number();
			$("button:first").on('click', function(event) {
		        event.preventDefault();
		        generateSubstructions(n.getNumberSetForSubstruction());
		    });
		    $("button:eq(1)").on('click', function(event) {
		        event.preventDefault();
		        generateAdditions(n.getNumberSetForAddition());
		    });

		});
		var bindEvent = (function() {
			$("td[contenteditable='true']").unbind('keydown');
		    $("td[contenteditable='true']").on('keydown', function(event) {
		    	var charCode = (event.which) ? event.which : event.keyCode;
			    if (charCode > 31 && (charCode < 48 || charCode > 57)) {
			        return false;
			    }
			});
			$("td[contenteditable='true']").unbind('keyup');
			$('td[contenteditable="true"]').on('keyup', function(event) {
				if($(event.currentTarget).text().length>0) {
			    	checkResult(parseInt($(event.currentTarget).text()), parseInt($(event.currentTarget).parent().parent().parent().data('index')),$(event.currentTarget)[0]);
			    }
			})
		});
	</script>
</html>
